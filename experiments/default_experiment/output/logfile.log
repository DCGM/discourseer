DEBUG:root:run_discourseer.py:main: Python file location: /home/xvlach22/skola/10-sem-23-24-letni/PP1/discourseer/run_discourseer.py
DEBUG:root:run_discourseer.py:main: Arguments: Namespace(experiment_dir='/home/xvlach22/projects/discourseer/experiments/default_experiment', texts_dir=None, ratings_dir=None, output_dir=None, prompt_schema_definition=None, prompt_definitions=None, prompt_subset=[], text_count=None, copy_input_ratings=<RatingsCopyMode.none: 'none'>, openai_api_key=None, log='DEBUG')
DEBUG:root:run_discourseer.py:prepare_output_dir: Directory /home/xvlach22/projects/discourseer/experiments/default_experiment/output already exists. Saving the result to /home/xvlach22/projects/discourseer/experiments/default_experiment/output_20240924-143808
DEBUG:root:run_discourseer.py:load_prompts: Loading prompts from file: /home/xvlach22/projects/discourseer/experiments/default_experiment/prompt_definitions.json
DEBUG:root:run_discourseer.py:load_prompt_schema_definition: Loading prompt definition from file:/home/xvlach22/projects/discourseer/experiments/default_experiment/prompt_schema_definition.json
DEBUG:httpx:_config.py:load_ssl_context: load_ssl_context verify=True cert=None trust_env=True http2=False
DEBUG:httpx:_config.py:load_ssl_context_verify: load_verify_locations cafile='/etc/ssl/certs/ca-certificates.crt'
DEBUG:openai._base_client:_base_client.py:_build_request: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': 'You are a friendly chat bot.'}, {'role': 'user', 'content': 'Say Hi!'}], 'model': 'gpt-3.5-turbo'}}
DEBUG:httpcore.connection:_trace.py:trace: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=5.0 socket_options=None
DEBUG:httpcore.connection:_trace.py:trace: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7d9aae25c730>
DEBUG:httpcore.connection:_trace.py:trace: start_tls.started ssl_context=<ssl.SSLContext object at 0x7d9aae3c1840> server_hostname='api.openai.com' timeout=5.0
DEBUG:httpcore.connection:_trace.py:trace: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7d9aae25c700>
DEBUG:httpcore.http11:_trace.py:trace: send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:_trace.py:trace: send_request_headers.complete
DEBUG:httpcore.http11:_trace.py:trace: send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:_trace.py:trace: send_request_body.complete
DEBUG:httpcore.http11:_trace.py:trace: receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:_trace.py:trace: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 24 Sep 2024 12:38:09 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-eojliflj4bavern4nobjkpw0'), (b'openai-processing-ms', b'194'), (b'openai-version', b'2020-10-01'), (b'strict-transport-security', b'max-age=15552000; includeSubDomains; preload'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'200000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'199972'), (b'x-ratelimit-reset-requests', b'8.64s'), (b'x-ratelimit-reset-tokens', b'8ms'), (b'x-request-id', b'req_471a5a8755f9da7a3da1d07a4d4988cb'), (b'CF-Cache-Status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=Hm84dY3JbPz0rHQvACuL7AJRkPDdA.dCjOziU09UM2g-1727181489-1.0.1.1-wdzvsHRkaPXrx1LLKOnPRfFCJLQjHO_Kr_MsszS67vnXrhGELqX_lME8lWVHMkARIq.LCMR8NYvd1YvYjFaDwA; path=/; expires=Tue, 24-Sep-24 13:08:09 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=XRNvc6dD.FeJaYy8z8isxnKHjG1xMgwP6cPWj6Vgld8-1727181489786-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'8c82d4722f492794-PRG'), (b'Content-Encoding', b'gzip')])
INFO:httpx:_client.py:_send_single_request: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:_trace.py:trace: receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:_trace.py:trace: receive_response_body.complete
DEBUG:httpcore.http11:_trace.py:trace: response_closed.started
DEBUG:httpcore.http11:_trace.py:trace: response_closed.complete
DEBUG:openai._base_client:_base_client.py:_request: HTTP Request: POST https://api.openai.com/v1/chat/completions "200 OK"
INFO:root:run_discourseer.py:__init__: First prompt: You are a media content analyst. You are analyzing the following text to extract {prompt_names}. {pr...
DEBUG:root:run_discourseer.py:extract_answers: New document:


DEBUG:root:run_discourseer.py:extract_answers: Extracting answers from text: Tvrdík skončil jako viceprezident čínské Citic, ch...
DEBUG:root:chat_client.py:ensure_maximal_length: Messages length in chars: 4991
DEBUG:root:chat_client.py:ensure_maximal_length: Current maximal chars: 35000
DEBUG:openai._base_client:_base_client.py:_build_request: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': 'You are a media content analyst. You are analyzing the following text to extract range, genre, message-trigger, place. range: Number of paragraphs in the text. genre: The genre of the text. message-trigger: The message trigger is the event or situation that causes the message to be sent. place: The country where the event or situation occurs.. For every question pick only options from these lists.\nrange: 1 (1 paragraph.), 2 (2 paragraphs.), 3 (3 paragraphs.), 4 (4 paragraphs.), 5 (5 paragraphs.), 6 (6 paragraphs.), 7 (7 paragraphs.), 8 (8 paragraphs.), 9 (9 paragraphs.), 10 (10 paragraphs.)\ngenre: report (Report is information about a current event answering questions: who, what, where.), extended_report (Report is information about a current event answering questions: who, what, where, when, how and why.), interview (Interview is a conversation between two or more people.), other (Other genre.)\nmessage-trigger: politician (The message reacts on actions of a politician), security-forces (The message reacts on action of security forces.), public (The message reacts on action of public.), other (Other message trigger.)\nplace: czech-republic (The event or situation occurs in the Czech Republic.), slovakia (The event or situation occurs in Slovakia.), poland (The event or situation occurs in Poland.), germany (The event or situation occurs in Germany.), russia (The event or situation occurs in Russia.), ukraine (The event or situation occurs in Ukraine.), other (The event or situation occurs in other country.), unknown (The event or situation occurs in unknown country.)\n\nYou will pick one option for these questions: range, genre, message-trigger. You will pick one or more options for these prompts: place.\nText will be in Czech language. JSON anwers will be in same language as the options are. You will give answer in JSON format according to this schema:'}, {'role': 'system', 'content': '{\n  "properties": {\n    "range": {\n      "enum": [\n        "1",\n        "2",\n        "3",\n        "4",\n        "5",\n        "6",\n        "7",\n        "8",\n        "9",\n        "10"\n      ],\n      "title": "Range",\n      "type": "string"\n    },\n    "genre": {\n      "enum": [\n        "report",\n        "extended_report",\n        "interview",\n        "other"\n      ],\n      "title": "Genre",\n      "type": "string"\n    },\n    "message-trigger": {\n      "enum": [\n        "politician",\n        "security-forces",\n        "public",\n        "other"\n      ],\n      "title": "Message-Trigger",\n      "type": "string"\n    },\n    "place": {\n      "items": {\n        "enum": [\n          "czech-republic",\n          "slovakia",\n          "poland",\n          "germany",\n          "russia",\n          "ukraine",\n          "other",\n          "unknown"\n        ],\n        "type": "string"\n      },\n      "title": "Place",\n      "type": "array"\n    }\n  },\n  "required": [\n    "range",\n    "genre",\n    "message-trigger",\n    "place"\n  ],\n  "title": "ResponseFormat",\n  "type": "object"\n}'}, {'role': 'user', 'content': 'The text to analyze is: Tvrdík skončil jako viceprezident čínské Citic, chce se více věnovat Slavii\n\nJaroslav Tvrdík skončil jako viceprezident čínské Citic Europe Holding, pokračovat\nbude jen jako člen představenstva skupiny. Končí i jako šéf představenstva Pivovarů\nLobkowicz. Prioritou je pro něj rozvoj fotbalové Slavie. Někdejší sociálnědemokratický\npolitik se tak rozhodl krátce poté, co Slavii koupil od společnosti Citic miliardář\nPavel Tykač, informoval o tom portál Seznam Zprávy.\n\n„V souvislosti s prodejem SK Slavia Praha novému akcionáři a s ohledem na svůj zdravotní\nstav jsem se rozhodl upravit svoje časové priority a pracovní nasazení. Proto jsem opustil\nvýkonné funkce v Citic Europe Holding včetně pozice viceprezidenta skupiny nebo předsedy\npředstavenstva Pivovary Lobkowicz Group,“ řekl Tvrdík na dotaz SZ Byznys. „Nově budu působit\nv Citic Europe Holding pouze jako člen představenstva skupiny a chci se výrazněji věnovat\nrozvoji Slavie pod Pavlem Tykačem,“ dodal Tvrdík.\n\nV roce 2013 získal Tvrdík místo neplaceného „honorárního poradce“ premiéra pro vztahy s\nČínou. Od roku 2012 je prezidentem Smíšené česko čínské komory vzájemné spolupráce a\nje spojen s pronikáním čínského kapitálu na český trh. Komora byla mimo jiné zadavatelem\nvyvěšení vlajek při návštěvě čínského prezidenta v roce 2016. Jako zástupce CEFC se Tvrdík\nv roce 2015 podílel na převzetí fotbalového klubu Slavia Praha čínským investorem. Do vedení\nSlavie se dostal již v říjnu 2015, kdy byl zvolen místopředsedou dozorčí rady.\n\nÚřad pro ochranu hospodářské soutěže minulý týden informoval, že podnikatel a investor Tykač\nmůže od čínské společnosti Citic Group prostřednictvím společnosti Fulleren fotbalový\nklub Slavia Praha včetně stadionu v Edenu koupit. Úřad to povolil ve zjednodušeném řízení,\nrozhodnutí je pravomocné. Citic byla majoritním vlastníkem pět let, před ní červenobílí patřili\nod roku 2015 jiné čínské společnosti CEFC. Klub o transakci informoval v prosinci, cenu nezveřejnil,\npodle odhadů médií činí zhruba dvě miliardy korun.\n'}], 'model': 'gpt-3.5-turbo-0125', 'max_tokens': 1024, 'temperature': 0.0, 'top_p': 0.0}}
DEBUG:httpcore.http11:_trace.py:trace: send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:_trace.py:trace: send_request_headers.complete
DEBUG:httpcore.http11:_trace.py:trace: send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:_trace.py:trace: send_request_body.complete
DEBUG:httpcore.http11:_trace.py:trace: receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:_trace.py:trace: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 24 Sep 2024 12:38:10 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-eojliflj4bavern4nobjkpw0'), (b'openai-processing-ms', b'572'), (b'openai-version', b'2020-10-01'), (b'strict-transport-security', b'max-age=15552000; includeSubDomains; preload'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'200000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'197678'), (b'x-ratelimit-reset-requests', b'8.64s'), (b'x-ratelimit-reset-tokens', b'696ms'), (b'x-request-id', b'req_3ae34fed34c58f8cf3d2dd90f3ff5032'), (b'CF-Cache-Status', b'DYNAMIC'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'8c82d4775e8a2794-PRG'), (b'Content-Encoding', b'gzip')])
INFO:httpx:_client.py:_send_single_request: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:_trace.py:trace: receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:_trace.py:trace: receive_response_body.complete
DEBUG:httpcore.http11:_trace.py:trace: response_closed.started
DEBUG:httpcore.http11:_trace.py:trace: response_closed.complete
DEBUG:openai._base_client:_base_client.py:_request: HTTP Request: POST https://api.openai.com/v1/chat/completions "200 OK"
DEBUG:root:run_discourseer.py:extract_answers: Response: {'range': '3', 'genre': 'extended_report', 'message-trigger': 'politician', 'place': ['czech-republic']}
DEBUG:root:rater.py:add_model_response: Adding rating: range, 3
DEBUG:root:rater.py:add_model_response: saved rating: file='Tvrdík_skončil_jako_viceprezident.txt' prompt_key='range-v1' question_id='rozsah' rating_results=['3']
DEBUG:root:rater.py:add_model_response: Adding rating: genre, extended_report
DEBUG:root:rater.py:add_model_response: saved rating: file='Tvrdík_skončil_jako_viceprezident.txt' prompt_key='genre-v1' question_id='zanr' rating_results=['extended_report']
DEBUG:root:rater.py:add_model_response: Adding rating: message-trigger, politician
DEBUG:root:rater.py:add_model_response: saved rating: file='Tvrdík_skončil_jako_viceprezident.txt' prompt_key='message-trigger-v1' question_id='spoustec-zpravy' rating_results=['politician']
DEBUG:root:rater.py:add_model_response: Adding rating: place, ['czech-republic']
DEBUG:root:rater.py:add_model_response: saved rating: file='Tvrdík_skončil_jako_viceprezident.txt' prompt_key='place-v1' question_id='misto' rating_results=['czech-republic']
DEBUG:root:run_discourseer.py:extract_answers: New document:


DEBUG:root:run_discourseer.py:extract_answers: Extracting answers from text: Chci spravedlnost pro dceru Elišku, říká matka zav...
DEBUG:root:chat_client.py:ensure_maximal_length: Messages length in chars: 4285
DEBUG:root:chat_client.py:ensure_maximal_length: Current maximal chars: 35000
DEBUG:openai._base_client:_base_client.py:_build_request: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': 'You are a media content analyst. You are analyzing the following text to extract range, genre, message-trigger, place. range: Number of paragraphs in the text. genre: The genre of the text. message-trigger: The message trigger is the event or situation that causes the message to be sent. place: The country where the event or situation occurs.. For every question pick only options from these lists.\nrange: 1 (1 paragraph.), 2 (2 paragraphs.), 3 (3 paragraphs.), 4 (4 paragraphs.), 5 (5 paragraphs.), 6 (6 paragraphs.), 7 (7 paragraphs.), 8 (8 paragraphs.), 9 (9 paragraphs.), 10 (10 paragraphs.)\ngenre: report (Report is information about a current event answering questions: who, what, where.), extended_report (Report is information about a current event answering questions: who, what, where, when, how and why.), interview (Interview is a conversation between two or more people.), other (Other genre.)\nmessage-trigger: politician (The message reacts on actions of a politician), security-forces (The message reacts on action of security forces.), public (The message reacts on action of public.), other (Other message trigger.)\nplace: czech-republic (The event or situation occurs in the Czech Republic.), slovakia (The event or situation occurs in Slovakia.), poland (The event or situation occurs in Poland.), germany (The event or situation occurs in Germany.), russia (The event or situation occurs in Russia.), ukraine (The event or situation occurs in Ukraine.), other (The event or situation occurs in other country.), unknown (The event or situation occurs in unknown country.)\n\nYou will pick one option for these questions: range, genre, message-trigger. You will pick one or more options for these prompts: place.\nText will be in Czech language. JSON anwers will be in same language as the options are. You will give answer in JSON format according to this schema:'}, {'role': 'system', 'content': '{\n  "properties": {\n    "range": {\n      "enum": [\n        "1",\n        "2",\n        "3",\n        "4",\n        "5",\n        "6",\n        "7",\n        "8",\n        "9",\n        "10"\n      ],\n      "title": "Range",\n      "type": "string"\n    },\n    "genre": {\n      "enum": [\n        "report",\n        "extended_report",\n        "interview",\n        "other"\n      ],\n      "title": "Genre",\n      "type": "string"\n    },\n    "message-trigger": {\n      "enum": [\n        "politician",\n        "security-forces",\n        "public",\n        "other"\n      ],\n      "title": "Message-Trigger",\n      "type": "string"\n    },\n    "place": {\n      "items": {\n        "enum": [\n          "czech-republic",\n          "slovakia",\n          "poland",\n          "germany",\n          "russia",\n          "ukraine",\n          "other",\n          "unknown"\n        ],\n        "type": "string"\n      },\n      "title": "Place",\n      "type": "array"\n    }\n  },\n  "required": [\n    "range",\n    "genre",\n    "message-trigger",\n    "place"\n  ],\n  "title": "ResponseFormat",\n  "type": "object"\n}'}, {'role': 'user', 'content': 'The text to analyze is: Chci spravedlnost pro dceru Elišku, říká matka zavražděné studentky z fakulty\n\nEliška Šimůnková by v lednu oslavila dvacáté první narozeniny. Kvůli prosincovému\nřádění šíleného střelce Davida K. na filozofické fakultě se jich však nedožila.\nJejí matka Lenka byla první z pozůstalých čtrnácti vrahových obětí, která se rozhodla\npromluvit veřejně.\n\nVe svém emotivním vystoupení v pořadu 168 hodin České televize kromě jiného opakovaně\nvyzvala policii, aby jí vysvětlila, co se ten den stalo. „Pokud policie stála před\nuniverzitou a byla tam z nějakého důvodu přivolána, z jakého důvodu byla odvolána.\nJaký byl ten důvod? Kdo odvolal policii od fakulty, kde byly děti? Chci vás vidět a chci,\nabyste mi to řekl do očí. Chci vidět pravdu o čtvrtku,“ uvedla doslova.\n\nPro rozhovor s MF DNES si Lenka Šimůnková vyžádala otázky prostřednictvím e-mailu.\nS vysvětlením, že se jí tak odpovědi budou formulovat přesněji. Policie se jí dosud\nneozvala a ona v ni podle svých slov už nemá důvěru.\n\n„Neukazuje mi dosud, že bych mít měla. Domnívám se, že se snaží zakrýt fatální pochybení\ns hrůzně tragickými následky,“ napsala Lenka Šimůnková.\n\nV rozhovoru mluví i o tom, že chtěla nahlédnout přímo do policejního spisu, přála by si\nzřízení vyšetřovací komise ve Sněmovně, a že by si ráda promluvila s matkou vraha Davida K.\n'}], 'model': 'gpt-3.5-turbo-0125', 'max_tokens': 1024, 'temperature': 0.0, 'top_p': 0.0}}
DEBUG:httpcore.http11:_trace.py:trace: send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:_trace.py:trace: send_request_headers.complete
DEBUG:httpcore.http11:_trace.py:trace: send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:_trace.py:trace: send_request_body.complete
DEBUG:httpcore.http11:_trace.py:trace: receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:_trace.py:trace: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 24 Sep 2024 12:38:11 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-eojliflj4bavern4nobjkpw0'), (b'openai-processing-ms', b'686'), (b'openai-version', b'2020-10-01'), (b'strict-transport-security', b'max-age=15552000; includeSubDomains; preload'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'200000'), (b'x-ratelimit-remaining-requests', b'9998'), (b'x-ratelimit-remaining-tokens', b'197867'), (b'x-ratelimit-reset-requests', b'16.343s'), (b'x-ratelimit-reset-tokens', b'639ms'), (b'x-request-id', b'req_0f3b38aea73eae022c12a38f73b06878'), (b'CF-Cache-Status', b'DYNAMIC'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'8c82d47d5ff02794-PRG'), (b'Content-Encoding', b'gzip')])
INFO:httpx:_client.py:_send_single_request: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:_trace.py:trace: receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:_trace.py:trace: receive_response_body.complete
DEBUG:httpcore.http11:_trace.py:trace: response_closed.started
DEBUG:httpcore.http11:_trace.py:trace: response_closed.complete
DEBUG:openai._base_client:_base_client.py:_request: HTTP Request: POST https://api.openai.com/v1/chat/completions "200 OK"
DEBUG:root:run_discourseer.py:extract_answers: Response: {'range': '3', 'genre': 'report', 'message-trigger': 'public', 'place': ['czech-republic']}
DEBUG:root:rater.py:add_model_response: Adding rating: range, 3
DEBUG:root:rater.py:add_model_response: saved rating: file='Chci_spravedlnost_pro_dceru.txt' prompt_key='range-v1' question_id='rozsah' rating_results=['3']
DEBUG:root:rater.py:add_model_response: Adding rating: genre, report
DEBUG:root:rater.py:add_model_response: saved rating: file='Chci_spravedlnost_pro_dceru.txt' prompt_key='genre-v1' question_id='zanr' rating_results=['report']
DEBUG:root:rater.py:add_model_response: Adding rating: message-trigger, public
DEBUG:root:rater.py:add_model_response: saved rating: file='Chci_spravedlnost_pro_dceru.txt' prompt_key='message-trigger-v1' question_id='spoustec-zpravy' rating_results=['public']
DEBUG:root:rater.py:add_model_response: Adding rating: place, ['czech-republic']
DEBUG:root:rater.py:add_model_response: saved rating: file='Chci_spravedlnost_pro_dceru.txt' prompt_key='place-v1' question_id='misto' rating_results=['czech-republic']
DEBUG:root:run_discourseer.py:extract_answers: New document:


DEBUG:root:run_discourseer.py:extract_answers: Extracting answers from text: Rusko použilo hypersonickou střelu Zirkon na Ukraj...
DEBUG:root:chat_client.py:ensure_maximal_length: Messages length in chars: 3984
DEBUG:root:chat_client.py:ensure_maximal_length: Current maximal chars: 35000
DEBUG:openai._base_client:_base_client.py:_build_request: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': 'You are a media content analyst. You are analyzing the following text to extract range, genre, message-trigger, place. range: Number of paragraphs in the text. genre: The genre of the text. message-trigger: The message trigger is the event or situation that causes the message to be sent. place: The country where the event or situation occurs.. For every question pick only options from these lists.\nrange: 1 (1 paragraph.), 2 (2 paragraphs.), 3 (3 paragraphs.), 4 (4 paragraphs.), 5 (5 paragraphs.), 6 (6 paragraphs.), 7 (7 paragraphs.), 8 (8 paragraphs.), 9 (9 paragraphs.), 10 (10 paragraphs.)\ngenre: report (Report is information about a current event answering questions: who, what, where.), extended_report (Report is information about a current event answering questions: who, what, where, when, how and why.), interview (Interview is a conversation between two or more people.), other (Other genre.)\nmessage-trigger: politician (The message reacts on actions of a politician), security-forces (The message reacts on action of security forces.), public (The message reacts on action of public.), other (Other message trigger.)\nplace: czech-republic (The event or situation occurs in the Czech Republic.), slovakia (The event or situation occurs in Slovakia.), poland (The event or situation occurs in Poland.), germany (The event or situation occurs in Germany.), russia (The event or situation occurs in Russia.), ukraine (The event or situation occurs in Ukraine.), other (The event or situation occurs in other country.), unknown (The event or situation occurs in unknown country.)\n\nYou will pick one option for these questions: range, genre, message-trigger. You will pick one or more options for these prompts: place.\nText will be in Czech language. JSON anwers will be in same language as the options are. You will give answer in JSON format according to this schema:'}, {'role': 'system', 'content': '{\n  "properties": {\n    "range": {\n      "enum": [\n        "1",\n        "2",\n        "3",\n        "4",\n        "5",\n        "6",\n        "7",\n        "8",\n        "9",\n        "10"\n      ],\n      "title": "Range",\n      "type": "string"\n    },\n    "genre": {\n      "enum": [\n        "report",\n        "extended_report",\n        "interview",\n        "other"\n      ],\n      "title": "Genre",\n      "type": "string"\n    },\n    "message-trigger": {\n      "enum": [\n        "politician",\n        "security-forces",\n        "public",\n        "other"\n      ],\n      "title": "Message-Trigger",\n      "type": "string"\n    },\n    "place": {\n      "items": {\n        "enum": [\n          "czech-republic",\n          "slovakia",\n          "poland",\n          "germany",\n          "russia",\n          "ukraine",\n          "other",\n          "unknown"\n        ],\n        "type": "string"\n      },\n      "title": "Place",\n      "type": "array"\n    }\n  },\n  "required": [\n    "range",\n    "genre",\n    "message-trigger",\n    "place"\n  ],\n  "title": "ResponseFormat",\n  "type": "object"\n}'}, {'role': 'user', 'content': 'The text to analyze is: Rusko použilo hypersonickou střelu Zirkon na Ukrajině, dosvědčují to úlomky\n\nRusko při útoku na Ukrajinu začátkem února použilo svou novou hypersonickou střelu Zirkon.\nDosvědčuje to značení na nalezených úlomcích, uvedl šéf Kyjevského výzkumného institutu\nforenzních expertiz Oleksandr Ruvin. Ruský prezident Vladimir Putin označil Zirkon za součást\nnové generace bezkonkurenčních zbraňových systémů.\n\nNadzvukovou střelu Zirkon Rusko podle Ruvina použilo ve středu 7. února. Ředitel kyjevského\ninstitutu to uvedl na platformě Telegram, kde zároveň zveřejnil záběry úlomků rakety. Nalezeny\nbyly fragmenty motoru a řídících mechanismů.\n\nAgentura Reuters poznamenala, že jde o novou výzvu pro ukrajinskou protivzdušnou obranu.\nPůvodně protilodní střely Zirkon jsou totiž podle dřívějších prohlášení ruské armády schopny\ndosáhnout až devítinásobku rychlosti zvuku a při doletu od 600 do 1 500 kilometrů můžou\nzasahovat námořní i pozemní cíle. Pravděpodobně tak budou zasahovat objekty hlouběji v\nokupované zemi.\n'}], 'model': 'gpt-3.5-turbo-0125', 'max_tokens': 1024, 'temperature': 0.0, 'top_p': 0.0}}
DEBUG:httpcore.http11:_trace.py:trace: send_request_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:_trace.py:trace: send_request_headers.complete
DEBUG:httpcore.http11:_trace.py:trace: send_request_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:_trace.py:trace: send_request_body.complete
DEBUG:httpcore.http11:_trace.py:trace: receive_response_headers.started request=<Request [b'POST']>
DEBUG:httpcore.http11:_trace.py:trace: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 24 Sep 2024 12:38:12 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-eojliflj4bavern4nobjkpw0'), (b'openai-processing-ms', b'642'), (b'openai-version', b'2020-10-01'), (b'strict-transport-security', b'max-age=15552000; includeSubDomains; preload'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'200000'), (b'x-ratelimit-remaining-requests', b'9997'), (b'x-ratelimit-remaining-tokens', b'197953'), (b'x-ratelimit-reset-requests', b'24.055s'), (b'x-ratelimit-reset-tokens', b'613ms'), (b'x-request-id', b'req_2cd372514ceff2dead9ece5641fdba38'), (b'CF-Cache-Status', b'DYNAMIC'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'8c82d4832fff2794-PRG'), (b'Content-Encoding', b'gzip')])
INFO:httpx:_client.py:_send_single_request: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
DEBUG:httpcore.http11:_trace.py:trace: receive_response_body.started request=<Request [b'POST']>
DEBUG:httpcore.http11:_trace.py:trace: receive_response_body.complete
DEBUG:httpcore.http11:_trace.py:trace: response_closed.started
DEBUG:httpcore.http11:_trace.py:trace: response_closed.complete
DEBUG:openai._base_client:_base_client.py:_request: HTTP Request: POST https://api.openai.com/v1/chat/completions "200 OK"
DEBUG:root:run_discourseer.py:extract_answers: Response: {'range': '3', 'genre': 'report', 'message-trigger': 'security-forces', 'place': ['ukraine']}
DEBUG:root:rater.py:add_model_response: Adding rating: range, 3
DEBUG:root:rater.py:add_model_response: saved rating: file='Rusko_použilo_hypersonickou_střelu_Zirkon.txt' prompt_key='range-v1' question_id='rozsah' rating_results=['3']
DEBUG:root:rater.py:add_model_response: Adding rating: genre, report
DEBUG:root:rater.py:add_model_response: saved rating: file='Rusko_použilo_hypersonickou_střelu_Zirkon.txt' prompt_key='genre-v1' question_id='zanr' rating_results=['report']
DEBUG:root:rater.py:add_model_response: Adding rating: message-trigger, security-forces
DEBUG:root:rater.py:add_model_response: saved rating: file='Rusko_použilo_hypersonickou_střelu_Zirkon.txt' prompt_key='message-trigger-v1' question_id='spoustec-zpravy' rating_results=['security-forces']
DEBUG:root:rater.py:add_model_response: Adding rating: place, ['ukraine']
DEBUG:root:rater.py:add_model_response: saved rating: file='Rusko_použilo_hypersonickou_střelu_Zirkon.txt' prompt_key='place-v1' question_id='misto' rating_results=['ukraine']
DEBUG:root:inter_rater_reliability.py:clean_data: Removed 0/33 rows with NaN values.
DEBUG:root:inter_rater_reliability.py:get_inter_rater_reliability: Calculating inter-rater reliability for (see whole in /home/xvlach22/projects/discourseer/experiments/default_experiment/output_20240924-143808/dataframe.csv):
                                                                                  rater_1.csv rater_2.csv      rater_3.csv            model         majority  maj_agreement_with_model    worst_case
file                                          prompt_key      rating                                                                                                                                
Chci_spravedlnost_pro_dceru.txt               misto           czech-republic             True        True             True             True             True                      True         False
                                                              germany                   False       False            False            False            False                      True          True
                                                              other                     False       False            False            False            False                      True          True
                                                              poland                    False       False            False            False            False                      True          True
                                                              russia                    False       False            False            False            False                      True          True
                                                              slovakia                  False       False            False            False            False                      True          True
                                                              ukraine                   False       False            False            False            False                      True          True
                                                              unknown                   False       False            False            False            False                      True          True
                                              rozsah          single_choice                 5           5                5                3                5                     False  --WORST-CASE
                                              spoustec-zpravy single_choice            public      public  security-forces           public           public                      True  --WORST-CASE
                                              zanr            single_choice            report       other           report           report           report                      True  --WORST-CASE
Rusko_použilo_hypersonickou_střelu_Zirkon.txt misto           czech-republic            False       False            False            False            False                      True          True
                                                              germany                   False       False            False            False            False                      True          True
                                                              other                     False       False            False            False            False                      True          True
                                                              poland                    False       False            False            False            False                      True          True
                                                              russia                     True        True             True            False             True                     False         False
                                                              slovakia                  False       False            False            False            False                      True          True
                                                              ukraine                    True        True             True             True             True                      True         False
                                                              unknown                   False       False            False            False            False                      True          True
                                              rozsah          single_choice                 3           3                3                3                3                      True  --WORST-CASE
                                              spoustec-zpravy single_choice   security-forces       other  security-forces  security-forces  security-forces                      True  --WORST-CASE
                                              zanr            single_choice            report      report           report           report           report                      True  --WORST-CASE
Tvrdík_skončil_jako_viceprezident.txt         misto           czech-republic             True        True             True             True             True                      True         False
                                                              germany                   False       False            False            False            False                      True          True
                                                              other                     False       False             True            False            False                      True          True
                                                              poland                    False       False            False            False            False                      True          True
                                                              russia                    False       False            False            False            False                      True          True
                                                              slovakia                  False       False            False            False            False                      True          True
                                                              ukraine                   False       False            False            False            False                      True          True
                                                              unknown                   False       False            False            False            False                      True          True
                                              rozsah          single_choice                 4           4                4                3                4                     False  --WORST-CASE
                                              spoustec-zpravy single_choice            public      public       politician       politician           public                     False  --WORST-CASE
                                              zanr            single_choice            report      report           report  extended_report           report                     False  --WORST-CASE
INFO:root:inter_rater_reliability.py:get_inter_rater_reliability: Calculating IRR for prompt misto
INFO:root:inter_rater_reliability.py:get_inter_rater_reliability: Calculating IRR for prompt rozsah
INFO:root:inter_rater_reliability.py:get_inter_rater_reliability: Calculating IRR for prompt spoustec-zpravy
INFO:root:inter_rater_reliability.py:get_inter_rater_reliability: Calculating IRR for prompt zanr
INFO:root:run_discourseer.py:save_output: Inter-rater reliability results summary:
{
  "overall": {
    "fleiss_kappa": {
      "best_case": 0.87627,
      "with_model": 0.76676,
      "worst_case": 0.21868,
      "without_model": 0.83582
    },
    "krippendorff_alpha": {
      "best_case": 0.8772,
      "with_model": 0.76852,
      "worst_case": 0.2246,
      "without_model": 0.83748
    },
    "gwet_ac1": {
      "best_case": 0.91871,
      "with_model": 0.84946,
      "worst_case": 0.41361,
      "without_model": 0.89158
    },
    "majority_agreement": 0.848
  },
  "mean_through_prompts": {
    "fleiss_kappa": {
      "best_case": 0.5094,
      "with_model": 0.33937,
      "worst_case": -0.03963,
      "without_model": 0.44528
    },
    "krippendorff_alpha": {
      "best_case": 0.54898,
      "with_model": 0.39169,
      "worst_case": 0.02652,
      "without_model": 0.50463
    },
    "gwet_ac1": {
      "best_case": 0.78558,
      "with_model": 0.58717,
      "worst_case": 0.14416,
      "without_model": 0.70662
    },
    "majority_agreement": 0.65625
  }
}
INFO:root:rater.py:save_to_csv: Rater model saved to /home/xvlach22/projects/discourseer/experiments/default_experiment/output_20240924-143808/model_ratings.csv
